<!DOCTYPE html>
<html xml:lang="en" lang="en-us">

  <head>
  <meta charset="utf-8" />
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
  <meta name="description" content="" />

  <title>
    
      Playing with Google Apps Scripts &middot; Hazzik's blog
    
  </title>

  <link href="http://gmpg.org/xfn/11" rel="profile">
  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/hyde.css">
  <link rel="stylesheet" href="/public/css/tags.css">
  <link rel="stylesheet" href="/public/css/social.css">
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">
  <link rel="stylesheet" href="//netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-144-precomposed.png">
                                 <link rel="shortcut icon" href="/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
  <meta name="google-site-verification" content="47dSjgZrewzbFXAnLPznjg7c_FE_SuVbOT0IEKn6h64" />
</head>


  <body>

    <div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="tag-cloud">
      <a href="/tag/dot-net" class="set-1">.NET</a> <a href="/tag/asp-dot-net-mvc" class="set-2">ASP.NET MVC</a> <a href="/tag/best-practicies" class="set-1">Best practicies</a> <a href="/tag/blog" class="set-1">Blog</a> <a href="/tag/computed-properties" class="set-1">Computed Properties</a> <a href="/tag/dataannotations" class="set-1">DataAnnotations</a> <a href="/tag/decompiler" class="set-1">Decompiler</a> <a href="/tag/delegate" class="set-1">Delegate</a> <a href="/tag/drop-down-lists" class="set-1">Drop down lists</a> <a href="/tag/git" class="set-2">Git</a> <a href="/tag/git-alias" class="set-1">Git Alias</a> <a href="/tag/google" class="set-1">Google</a> <a href="/tag/google-apps-script" class="set-1">Google Apps Script</a> <a href="/tag/javascript" class="set-1">JavaScript</a> <a href="/tag/linq" class="set-1">LINQ</a> <a href="/tag/mvcextensions" class="set-1">MvcExtensions</a> <a href="/tag/nhibernate" class="set-5">NHibernate</a> <a href="/tag/persistent-tree" class="set-1">Persistent-Tree</a> <a href="/tag/renderaction" class="set-1">RenderAction</a> <a href="/tag/tree" class="set-1">Tree</a> <a href="/tag/tree-hierarchy" class="set-1">Tree-Hierarchy</a> <a href="/tag/tree-structures" class="set-1">Tree-Structures</a>
    </div>
    <div class="sidebar-about">

      <h1><a href="/">Hazzik's blog</a></h1>
      <p class="lead"><a href="/"></a></p>

    </div>

    <ul class="sidebar-nav">
      <li class="sidebar-nav-item">
        <a href="/">Home</a>
      </li>

      

      
      
            <li class="sidebar-nav-item">
              <a href="/about/">About</a>
            </li>
      
    </ul>
    <ul class="sidebar-social">
      <li class="sidebar-social-item"><a href="http://twitter.com/hazzik" rel="me" alt="Twitter"><i class="fa fa-twitter"></i></a></li>
      &middot;
      <li class="sidebar-social-item"><a href="http://github.com/hazzik" rel="me" alt="GitHub"><i class="fa fa-github"></i></a></li>
      &middot;
      <li class="sidebar-social-item"><a href="http://linkedin.com/in/hazzik" rel="me" alt="LinkedIn"><i class="fa fa-linkedin"></i></a></li>
      &middot;
      <li class="sidebar-social-item"><a href="http://stackoverflow.com/users/259946/hazzik/" rel="me" alt="StackOverflow"><i class="fa fa-stack-overflow"></i></a></li>
      &middot;
      <li class="sidebar-social-item"><a href="http://alexzaytsev.me/atom.xml" alt="Subscribe"><i class="fa fa-rss"></i></i></a></li>
    </ul>

    <p>&copy; 2013 &mdash; 2017. <br/> All rights reserved.</p>
  </div>
</div>


    <div class="content container">
      <div class="post hentry">
  <h1 class="post-title entry-title">
    <a href="http://github.com/hazzik/alexzaytsev.me/edit/master/_posts/2014-11-10-playing-with-google-apps-script.md"><i class="fa fa-edit"></i></a> Playing with Google Apps Scripts
  </h1>
  <ul class="post-info">
    <li><i class="fa fa-calendar"></i><time datetime="2014-11-10T21:40:49+12:00" class="published"> 10 Nov 2014 </time></li>
    <li class="tags"><i class="fa fa-tags"></i> <a href="/tag/javascript" rel="tag">JavaScript</a>, <a href="/tag/google" rel="tag">Google</a>, <a href="/tag/google-apps-script" rel="tag">Google Apps Script</a></li>
    <li><i class="fa fa-comments"></i> <a href="/2014/11/10/playing-with-google-apps-script/#disqus_thread" data-disqus-identifier="/2014/11/10/playing-with-google-apps-script/">0 comments</a></li>
  </ul>
  <div class="entry-content">
    <p>Google has an Apps Script platform which allows you yo write scripts for most of Google products, such as Gmail, Drive, Spreadsheets, etc. The google script (extension .gs) is an JavaScript language subset. Google provides online editor for scripts, which is available at <a href="https://script.google.com">script.google.com</a>. The editor is an online IDE with basic autocompletion support, which is really nice. But I prefer to write Google Scripts in some mature desctop editors such as Visual Studio or at least Sublime Text.</p>

<p>I came across need of writing Google Script, when I wanted to sort my GitHub notification and remove some subscription emails.</p>

<p>Ok, lets start. First, open the <a href="https://script.google.com">script.google.com</a> page in your favourite browser. The page will ask you to choose an project type, or open recent project.</p>

<p><img src="/public/images/gs/step1.png" alt="Step 1"></p>

<p>I&#39;m going to select the &quot;Blank Project&quot; option.</p>

<p><img src="/public/images/gs/step2.png" alt="Step 2"></p>

<p>If you click on &quot;Untitled project&quot; you&#39;ll be able to give a sensible name for your project.</p>

<p><img src="/public/images/gs/step3.png" alt="Step 3"></p>

<p><img src="/public/images/gs/step4.png" alt="Step 4"></p>

<p>Then you can write a code. As manipulating emails means a lot of work with collection, so it would be nice to have something like <a href="http://underscorejs.org/">underscore.js</a> or <a href="https://lodash.com/">lodash.js</a> in place. I&#39;ll go with Lo-Dash. Just go to <a href="https://lodash.com">lodash.com</a> and dowload <a href="https://raw.github.com/lodash/lodash/2.4.1/dist/lodash.min.js">minified modern build</a>. </p>

<p>When you have Lo-Dash downloaded you need to import it to your Google Apps Script project. Press <em>File</em>-&gt;<em>New</em>-&gt;<em>Script File</em></p>

<p><img src="/public/images/gs/step5.png" alt="Step 5"></p>

<p>Enter the name of the file: LoDash</p>

<p><img src="/public/images/gs/step6.png" alt="Step 6"></p>

<p>Then copy and paste content of lodash.min.js to LoDash.gs and save the file.</p>

<p>And finally there is my code to sort Github label in the Gmail.</p>
<div class="highlight"><pre><code class="language-JavaScript" data-lang="JavaScript">function split() {
  // I have a filter in Gmail, which will put all emails from notifications@github.com 
  // to "GitHub" label and skip inbox for them
  // Get the 'GitHub' label
  var label = GmailApp.getUserLabelByName('GitHub');

  // Group all threads by Project Name. All notification emails have Project Name 
  // in square brackets in the email title. 
  var groups = _.groupBy(label.getThreads(), function(t) {
    var subject = t.getFirstMessageSubject();

    var tag = /\[([^\]]+)\]/.exec(subject);
    if (tag) {
      return label.getName() + '/' + tag[1];
    }
    return label.getName();
  });

  _.forEach(groups, function(threads, l) {
    if (label.getName() != l) {

      // Get or create a label for a project 
      var new_label = GmailApp.getUserLabelByName(l) || GmailApp.createLabel(l);

      // Label.addToThreads / Label.removeFromThreads has an restriction of
      // 100 threads per call, so we need to page our threads.
      var pages = _.groupBy(threads, function(t, i) { return (i / 100) &gt;&gt; 0; });

      _.forEach(pages, function(page) {
        new_label.addToThreads(page);
        label.removeFromThreads(page);  

        // If you call API to often you can reach call limit and script will stop execution
        Utilities.sleep(100);
      });
    }
  });
}
</code></pre></div>
<p>When we have code in place we want to add a trigger to run the script regularly. Click <em>Resources</em>-&gt;<em>Current project&#39;s triggers</em></p>

<p><img src="/public/images/gs/step9.png" alt="Step 9"></p>

<p>Then click on &quot;No triggers set up. Click here to add new now.&quot;</p>

<p><img src="/public/images/gs/step10.png" alt="Step 10"></p>

<p>Select the frequence you want your trigger to run. I&#39;ve chosen to run this script every five minutes. Click Save. The script will ask you for Authorisation.</p>

<p><img src="/public/images/gs/step11.png" alt="Step 11"></p>

<p>Press &quot;Continue&quot;. And then in the pop-up window review and Accept permissions for your script.</p>

<p><img src="/public/images/gs/step12.png" alt="Step 12"></p>

<p>Happy scripting!</p>

  </div>
</div>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- alexzaytsev.me -->
<ins class="adsbygoogle"
     style="display:inline-block;width:728px;height:15px"
     data-ad-client="ca-pub-6286543550478332"
     data-ad-slot="7799059444"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

  <div id="disqus_thread"></div>
  <script type="text/javascript">
      /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'hazzik-blog-en'; // required: replace example with your forum shortname
      var disqus_identifier = '/2014/11/10/playing-with-google-apps-script/';
      /* * * DON'T EDIT BELOW THIS LINE * * */
      (function() {
          var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
          dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>


<div class="related">
  <h2>Related Posts</h2>
  <ul class="related-posts">
    
      <li>
        <h3>
          <a href="/2015/01/20/nhibernate-4-0-3-released/">
            NHibernate 4.0.3 Released
            <small>20 Jan 2015</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/2014/11/16/nhibernate-4-0-2-released/">
            NHibernate 4.0.2 Released
            <small>16 Nov 2014</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/2014/10/19/git-filter-to-convert-spaces-to-tabs-and-vice-versa/">
            Git Filter to Convert Spaces to Tabs and Vice Versa
            <small>19 Oct 2014</small>
          </a>
        </h3>
      </li>
    
  </ul>
</div>

    </div>
<script type="text/javascript">
/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
var disqus_shortname = 'hazzik-blog-en'; // required: replace example with your forum shortname

/* * * DON'T EDIT BELOW THIS LINE * * */
(function () {
var s = document.createElement('script'); 
s.async = true;
s.type = 'text/javascript';
s.src = '//' + disqus_shortname + '.disqus.com/count.js';
(document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
}());
</script>

<!-- Yandex.Metrika counter -->
<script src="//mc.yandex.ru/metrika/watch.js" type="text/javascript"></script>
<script type="text/javascript">
try { var yaCounter25093751 = new Ya.Metrika({id:25093751,
          webvisor:true,
          clickmap:true,
          trackLinks:true,
          accurateTrackBounce:true});
} catch(e) { }
</script>
<noscript><div><img src="//mc.yandex.ru/watch/25093751" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
<!-- /Yandex.Metrika counter -->

  </body>
</html>
